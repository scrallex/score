Based on a close review of the **scrallex/score** repository and your recent outline, here’s a clear set of steps to finish the logistics‑guardrail project and the accompanying whitepaper:

### 1. Finish the logistics guardrail demo

1. **Verify the core simulation**:

   * Run `python score/scripts/logistics_guardrail_demo.py --output-root analysis/logistics_guardrail_demo` to ensure it produces `timeline.json` and `dashboard.html` without errors.
   * Check that the disruption (airport closure) is introduced at the expected step and that the metrics (`lambda`, coherence, stability, dilution) spike at the right time.

2. **Add twin retrieval and recovery suggestion (optional but powerful)**:

   * Extend `logistics_guardrail_demo.py` to optionally load a cached “twin” precedent from prior runs and display the suggested corrective action in the dashboard when a hazard alert fires.

3. **Ensure instrumentation is robust**:

   * Make sure the PDDL trace adapter in `stm_adapters/pddl_trace.py` is used and that it correctly tokenises PlanBench actions for the QFH engine.
   * Confirm that the guardrail uses calibrated thresholds (via the `calibrate_router.py` workflow) and that the hazard threshold matches your whitepaper narrative (e.g., λ > 0.538 triggers an alert three steps before failure).

4. **Polish the dashboard**:

   * Enhance the two‑column layout if necessary (left: classical validator with delayed failure; right: STM metrics with real‑time alert).
   * Add a legend and ensure the metrics plot has clear labels and highlights the alert point.

### 2. Complete the whitepaper

1. **Expand the outline in `docs/note/logistics_guardrail_outline.md`**:

   * Flesh out each section with prose. Use the “working abstract” and subsequent headings as scaffolding.
   * In the experimental section, refer explicitly to the 3‑step lead time and the λ threshold (e.g., “hazard λ > 0.538 at step 5; classical failure at step 8”).

2. **Generate figures**:

   * Use the timeline and dashboard generated by the demo to create at least two images:

     1. A side‑by‑side screenshot of the classical validator vs. STM guardrail panels.
     2. A line chart of λ (and possibly structural dilution) over time, with the alert point annotated.
   * Save these images under `docs/whitepaper/img/` and reference them in the paper.

3. **Write the experimental methodology**:

   * Describe how the trace was constructed: initial valid plan, mid‑run world change, how QFH tokens were generated.
   * Document the calibration process (router config, permutation testing) so that readers understand how hazard thresholds are determined.

4. **Compare to PDDL‑INSTRUCT**:

   * Add a section contrasting your real‑time guardrail with the post‑hoc VAL validator used in MIT’s work. Highlight that STM provides a bounded alert rate and actionable lead time.
   * Emphasise that STM complements, rather than replaces, strong symbolic planners.

5. **Finalize and convert**:

   * Once the markdown draft is complete, convert it to PDF (or another distribution format) with figures embedded.
   * Ensure the paper cites your original Structural Manifolds work and the new demo results.

### 3. Codex task recommendations

* **Code tasks**:

  1. Implement twin retrieval and recovery suggestion logic in `logistics_guardrail_demo.py`.
  2. Add shared helper functions in `score/src/sep_text_manifold` (or a new module) to simplify hazard threshold calibration and metric plotting.
  3. Write tests that simulate different disruption scenarios (e.g., airport closure, truck breakdown) to validate the guardrail’s lead‑time behaviour.

* **Documentation tasks**:

  1. Expand `docs/note/logistics_guardrail_outline.md` into a full whitepaper in `docs/whitepaper/`.
  2. Document how to run the demo and produce the dashboard (`README.md` update).
  3. Include a summary of the experiment’s statistical significance (p‑values, permutation tests) based on the permutation guardrail tool.

* **Deployment tasks**:

  1. Integrate the demo into your CI so it runs automatically after each QFH update.
  2. Optionally add a Streamlit or Flask front‑end to allow interactive exploration of different logistics scenarios.

By following these steps you’ll deliver a clear, compelling demonstration (and accompanying paper) that positions your STM guardrail as the missing runtime instrumentation for symbolic planning—exactly as described in your outline.
